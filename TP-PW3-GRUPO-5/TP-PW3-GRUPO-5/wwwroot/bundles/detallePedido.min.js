function AgregarArticulo(){let t=document.getElementById("articulo").value,r=document.getElementById("articulo"),i=r.options[r.selectedIndex].text;i=i.split("#")[0];let n=Number.parseInt(document.getElementById("cantidad").value);if(t==""||Number.isNaN(n))$("#errorSelect").html("Debe seleccionar un articulo y una cantidad.");else{let r={Codigo:t,Descripcion:i,Cantidad:n};if(articulos.length!=0){let i=articulos.findIndex(n=>n.Codigo==t);if(i!=-1){let n=articulos[i],t=n.Cantidad;r.Cantidad+=t;articulos.splice(i,1);r.Cantidad>0&&(articulos.push(r),$("#errorSelect").html(""));articulos.sort(Compare);CargarTabla(articulos)}else n>0?(articulos.push(r),$("#errorSelect").html("")):$("#errorSelect").html("Ingrese una cantidad valida"),articulos.sort(Compare),CargarTabla(articulos)}else n>0?(articulos.push(r),$("#errorSelect").html("")):$("#errorSelect").html("Ingrese una cantidad valida"),articulos.sort(Compare),CargarTabla(articulos)}}function Compare(n,t){return n.Codigo>t.Codigo?1:n.Codigo<t.Codigo?-1:0}function CargarTabla(n){if(articulos=n,articulos.sort(Compare),listado="",articulos.length==0)listado=`<tr class="text-center">
                   <td colspan = "4" >No se cargaron articulos</td >
                   </tr >`;else{let n=0;articulos.forEach(t=>{listado+=`<tr><td>
                ${t.Descripcion}
                </td>
                <td>
                ${t.Codigo}
                </td>
                <td>
                ${t.Cantidad}
                </td>
                <td>
                <a class='btnQuitar' onclick="QuitarArticulo(${n})">Quitar</a>
                </td>                  
        </tr>`,n++})}$("#tbody").html(listado)}function QuitarArticulo(n){articulos.splice(n,1);articulos.sort(Compare);CargarTabla(articulos)}function MandarForm(n){var r;let t=Number.parseInt(document.getElementById("IdPedido").value),i=document.getElementById("comentarios").value;r=n=="entregado"?{Comentarios:i,IdPedido:t,EstadoPedido:3}:n=="cerrar"?{Comentarios:i,IdPedido:t,EstadoPedido:2,Articulos:articulos}:{Comentarios:i,IdPedido:t,EstadoPedido:1,Articulos:articulos};fetch("https://localhost:44344/pedido/EditarPedido",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(r)}).then(n=>n.json()).then(n=>{window.location.href=n})}function ObtenerResultados(){let n=Number.parseInt(document.getElementById("IdPedido").value);fetch("https://localhost:44344/pedido/ObtenerDetallePedido",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(n)}).then(n=>n.json()).then(n=>{CargarTabla(n)})}function deshabilitarQuitar(){var n=Number.parseInt(document.getElementById("IdEstado").value);n!=1&&setTimeout(function(){$(".btnQuitar").hide();$("#comentarios").prop("disabled",!0)},50)}var articulos=[];$(document).ready(function(){$(".select2Pedido").select2();ObtenerResultados();deshabilitarQuitar()});